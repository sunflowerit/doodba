#!/bin/sh

SCRIPT_PATH=$(cd "$(dirname "$0")" && pwd)
cd $SCRIPT_PATH

rm -fr ./auto/odoo.conf
rm -fr ./auto/addons/*
/bin/bash -c "$(/bin/ls -1 ./custom/src | grep -Ev 'private|repos.yaml|addons.yaml' | /usr/bin/awk '{print("rm -fr ./custom/src/" $1)}')"

/usr/bin/direnv exec . /bin/bash -c '$HOME/.local/bin/pipenv run ./common/build'
cd $SCRIPT_PATH
/usr/bin/direnv exec . /bin/bash -c '$HOME/.local/bin/pipenv run python ./common/entrypoint'